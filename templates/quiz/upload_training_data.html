{% extends 'teacher/teacherbase.html' %}
{% load static %}

{% block content %}
<div class="container-fluid px-4">
    <h1 class="mt-4">Upload Training Data</h1>
    <ol class="breadcrumb mb-4">
        <li class="breadcrumb-item"><a href="{% url 'quiz:ai_dashboard' %}">AI Dashboard</a></li>
        <li class="breadcrumb-item active">Upload Training Data</li>
    </ol>
    
    <div class="row">
        <div class="col-xl-8">
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-upload me-1"></i>
                    Upload Training Data File
                </div>
                <div class="card-body">
                    <form id="uploadForm" method="post" enctype="multipart/form-data" action="{% url 'quiz:upload_training_data' %}">
                        {% csrf_token %}
                        
                        <div class="mb-3">
                            <label for="training_file" class="form-label">CSV File</label>
                            <input type="file" class="form-control" id="training_file" name="training_file" accept=".csv" required>
                            <div class="form-text">Upload a CSV file containing your training data. Make sure it includes the target column.</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="target_column" class="form-label">Target Column</label>
                            <input type="text" class="form-control" id="target_column" name="target_column" value="success" required>
                            <div class="form-text">Specify the name of the column that contains the target variable (e.g., 'success', 'outcome', 'result').</div>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-upload me-1"></i>
                                Upload and Process
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="col-xl-4">
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-info-circle me-1"></i>
                    Instructions
                </div>
                <div class="card-body">
                    <h5>CSV Format Requirements</h5>
                    <ul>
                        <li>File must be in CSV format</li>
                        <li>First row should contain column headers</li>
                        <li>Include a target column with binary values (0/1)</li>
                        <li>Missing values should be properly handled</li>
                    </ul>
                    
                    <h5>Example Columns</h5>
                    <ul>
                        <li>prev_score: Previous average score</li>
                        <li>attendance_rate: Percentage of attendance</li>
                        <li>quiz_completion: Percentage of quizzes completed</li>
                        <li>time_spent: Average study time</li>
                        <li>success: Target variable (1 = success, 0 = failure)</li>
                    </ul>
                    
                    <div class="alert alert-info mt-3">
                        <i class="fas fa-lightbulb me-1"></i>
                        For best results, ensure your data is clean and well-formatted. Consider preprocessing your data to handle missing values and outliers.
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="card mb-4" id="uploadResults" style="display: none;">
        <div class="card-header">
            <i class="fas fa-table me-1"></i>
            Upload Results
        </div>
        <div class="card-body">
            <div class="alert alert-success" id="successMessage"></div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Records Processed</h5>
                            <p class="card-text display-4" id="recordsProcessed">0</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Fields Detected</h5>
                            <p class="card-text display-4" id="fieldsDetected">0</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="mt-4">
                <h5>What's Next?</h5>
                <div class="d-grid gap-2 d-md-block">
                    <a href="{% url 'quiz:train_ai_model' %}" class="btn btn-primary">
                        <i class="fas fa-brain me-1"></i>
                        Train AI Model
                    </a>
                    <a href="{% url 'quiz:ai_dashboard' %}" class="btn btn-secondary">
                        <i class="fas fa-tachometer-alt me-1"></i>
                        Return to Dashboard
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    $(document).ready(function() {
        // Handle form submission with AJAX
        $('#uploadForm').on('submit', function(e) {
            e.preventDefault();
            
            var formData = new FormData(this);
            
            $.ajax({
                url: $(this).attr('action'),
                type: 'POST',
                data: formData,
                success: function(response) {
                    if (response.success) {
                        // Show results section
                        $('#uploadResults').show();
                        $('#successMessage').text('File uploaded and processed successfully!');
                        $('#recordsProcessed').text(response.records || 0);
                        $('#fieldsDetected').text(response.fields || 0);
                    } else {
                        alert('Error: ' + response.error);
                    }
                },
                error: function(xhr, status, error) {
                    alert('An error occurred: ' + error);
                },
                cache: false,
                contentType: false,
                processData: false
            });
        });
    });
</script>
{% endblock %} 