{% extends 'teacher/teacherbase.html' %}
{% load static %}

{% block title %}CUT AI Adoption Analytics Platform{% endblock %}

{% block custom_css %}
<style>
    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        color: #2d3748;
    }
    
    .ai-dashboard-container {
        min-height: 85vh;
        margin-top: 20px;
    }
    
    .nav-pills .nav-link {
        color: #4a5568;
        font-weight: 500;
        padding: 12px 20px;
        border-radius: 8px;
        margin-right: 8px;
        display: flex;
        align-items: center;
    }
    
    .nav-pills .nav-link i {
        margin-right: 8px;
    }
    
    .nav-pills .nav-link.active {
        background-color: #4299e1;
        color: white;
    }
    
    .tab-content {
        margin-top: 20px;
    }
    
    .upload-container {
        background-color: #fff;
        border-radius: 8px;
        padding: 25px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        margin-bottom: 30px;
    }
    
    .upload-area {
        border: 2px dashed #cbd5e0;
        border-radius: 8px;
        padding: 30px;
        text-align: center;
        background-color: #f7fafc;
        margin: 20px 0;
        transition: all 0.3s;
    }
    
    .upload-area:hover {
        border-color: #3182ce;
        background-color: #ebf8ff;
    }
    
    .upload-icon {
        font-size: 40px;
        color: #a0aec0;
        margin-bottom: 15px;
    }
    
    .file-item {
        display: flex;
        align-items: center;
        padding: 10px;
        background-color: #f7fafc;
        border-radius: 4px;
        margin-top: 10px;
    }
    
    .file-icon {
        color: #4299e1;
        font-size: 18px;
        margin-right: 10px;
    }
    
    .file-info {
        flex: 1;
    }
    
    .file-size {
        color: #718096;
        font-size: 12px;
    }
    
    .remove-file {
        color: #e53e3e;
        cursor: pointer;
    }
    
    .data-preview {
        background-color: #fff;
        border-radius: 8px;
        padding: 25px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        margin-bottom: 30px;
    }
    
    .data-table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .data-table th, .data-table td {
        padding: 10px;
        text-align: left;
        border-bottom: 1px solid #e2e8f0;
    }
    
    .data-table th {
        background-color: #f7fafc;
        font-weight: 500;
    }
    
    .status-message {
        padding: 15px;
        border-radius: 8px;
        margin: 20px 0;
    }
    
    .status-message.success {
        background-color: #c6f6d5;
        color: #276749;
    }
    
    .status-message.info {
        background-color: #bee3f8;
        color: #2c5282;
    }
    
    .stats-container {
        background-color: #fff;
        border-radius: 8px;
        padding: 25px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        margin-bottom: 30px;
    }
    
    .stats-grid {
        display: flex;
        justify-content: space-between;
        margin-top: 20px;
    }
    
    .stat-box {
        text-align: center;
        flex: 1;
        padding: 15px;
    }
    
    .stat-value {
        font-size: 28px;
        font-weight: 600;
        margin-bottom: 5px;
    }
    
    .stat-label {
        color: #718096;
        font-size: 14px;
    }
    
    .chart-container {
        background-color: #fff;
        border-radius: 8px;
        padding: 25px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        margin-bottom: 30px;
    }
    
    .chart-tabs {
        display: flex;
        border-bottom: 1px solid #e2e8f0;
        margin-bottom: 20px;
    }
    
    .chart-tab {
        padding: 10px 15px;
        margin-right: 5px;
        cursor: pointer;
        border-bottom: 2px solid transparent;
    }
    
    .chart-tab.active {
        border-bottom-color: #3182ce;
        color: #3182ce;
        font-weight: 500;
    }
    
    .chart-area {
        height: 300px;
    }
    
    .btn-primary {
        background-color: #4299e1;
        border-color: #4299e1;
        color: white;
        padding: 8px 16px;
        border-radius: 4px;
        font-weight: 500;
    }
    
    .btn-primary:hover {
        background-color: #3182ce;
        border-color: #3182ce;
    }
    
    .filter-container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 20px;
    }
    
    .filter-tag {
        background-color: #3182ce;
        color: white;
        padding: 6px 12px;
        border-radius: 16px;
        display: flex;
        align-items: center;
        font-size: 14px;
    }
    
    .filter-tag i {
        margin-left: 8px;
        cursor: pointer;
    }
    
    .prediction-container {
        background-color: #fff;
        border-radius: 8px;
        padding: 25px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        margin-bottom: 30px;
    }
    
    .prediction-value {
        font-size: 36px;
        font-weight: 700;
        color: #3182ce;
    }
    
    .prediction-change {
        display: flex;
        align-items: center;
        color: #48bb78;
        font-weight: 500;
        margin-top: 5px;
    }
    
    .prediction-change.negative {
        color: #e53e3e;
    }
    
    .prediction-change i {
        margin-right: 5px;
    }
    
    .factors-chart {
        height: 200px;
        margin-top: 20px;
    }
    
    .loading-indicator {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
    }
    
    .loading-spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #3182ce;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        animation: spin 1s linear infinite;
        margin-right: 10px;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    .about-section {
        padding: 0 20px;
        margin-bottom: 20px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <h1 class="mt-4">CUT AI Adoption Analytics Platform</h1>
    <ol class="breadcrumb mb-4">
        <li class="breadcrumb-item"><a href="{% url 'teacher-dashboard' %}">Dashboard</a></li>
        <li class="breadcrumb-item active">AI Adoption Analytics</li>
    </ol>
    
    <div class="ai-dashboard-container">
        <!-- Pill Navigation -->
        <ul class="nav nav-pills mb-4" id="aiTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="data-upload-tab" data-bs-toggle="pill" data-bs-target="#data-upload" type="button" role="tab">
                    <i class="fas fa-upload"></i> Data Upload
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="dashboard-tab" data-bs-toggle="pill" data-bs-target="#dashboard" type="button" role="tab">
                    <i class="fas fa-chart-bar"></i> Dashboard
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="predictions-tab" data-bs-toggle="pill" data-bs-target="#predictions" type="button" role="tab">
                    <i class="fas fa-brain"></i> AI Predictions
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="insights-tab" data-bs-toggle="pill" data-bs-target="#insights" type="button" role="tab">
                    <i class="fas fa-lightbulb"></i> Insights
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="admin-tab" data-bs-toggle="pill" data-bs-target="#admin" type="button" role="tab">
                    <i class="fas fa-cog"></i> Admin
                </button>
            </li>
        </ul>
        
        <!-- Tab Content -->
        <div class="tab-content" id="aiTabsContent">
            <!-- Data Upload Tab -->
            <div class="tab-pane fade show active" id="data-upload" role="tabpanel" aria-labelledby="data-upload-tab">
                <h2>Upload Survey Data</h2>
                <p class="text-muted">Upload your CSV file containing the AI adoption survey responses.</p>
                
                <div class="upload-container">
                    <h5>Choose a CSV file</h5>
                    <form id="uploadForm" enctype="multipart/form-data" action="{% url 'quiz:ajax_upload_csv' %}" method="post">
                        {% csrf_token %}
                        <div class="upload-area" id="drop-area">
                            <i class="fas fa-cloud-upload-alt upload-icon"></i>
                            <p>Drag and drop file here</p>
                            <p class="text-muted small">Limit 200MB per file â€¢ CSV</p>
                            <input type="file" id="fileInput" name="csv_file" accept=".csv" style="display: none;">
                            <button type="button" class="btn btn-primary" id="browseButton">Browse files</button>
                        </div>
                    </form>
                    
                    <div id="filePreview" style="display: none;">
                        <div class="file-item">
                            <i class="fas fa-file-csv file-icon"></i>
                            <div class="file-info">
                                <div id="fileName">filename.csv</div>
                                <div class="file-size" id="fileSize">0 KB</div>
                            </div>
                            <i class="fas fa-times remove-file" id="removeFile"></i>
                        </div>
                    </div>
                </div>
                
                <!-- Processing Indicator -->
                <div id="processingIndicator" class="loading-indicator" style="display: none;">
                    <div class="loading-spinner"></div>
                    <span id="processingText">RUNNING...</span>
                    <button id="stopProcessingBtn" class="btn btn-outline-secondary btn-sm ms-3">Stop</button>
                </div>
                
                <!-- Data Preview Section (initially hidden) -->
                <div id="dataPreviewSection" style="display: none;">
                    <div class="data-preview">
                        <h4>Data Preview</h4>
                        <div class="table-responsive">
                            <table class="data-table" id="previewTable">
                                <thead>
                                    <tr id="previewTableHeader">
                                        <!-- Table headers will be inserted here -->
                                    </tr>
                                </thead>
                                <tbody id="previewTableBody">
                                    <!-- Table rows will be inserted here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Success Message -->
                <div id="successMessage" class="status-message success" style="display: none;">
                    <i class="fas fa-check-circle me-2"></i>
                    <span id="successText">Data successfully uploaded! Added 0 new records.</span>
                </div>
                
                <!-- Skipped Records Message -->
                <div id="skippedMessage" class="status-message info" style="display: none;">
                    <i class="fas fa-info-circle me-2"></i>
                    <span id="skippedText">Skipped 0 existing records to avoid duplicates.</span>
                    <div class="form-check mt-2">
                        <input class="form-check-input" type="checkbox" id="showSkipped">
                        <label class="form-check-label" for="showSkipped">
                            Show skipped emails
                        </label>
                    </div>
                </div>
                
                <!-- Basic Statistics Section -->
                <div id="statsSection" style="display: none;">
                    <div class="stats-container">
                        <h4>Basic Statistics</h4>
                        <div class="stats-grid">
                            <div class="stat-box">
                                <div class="stat-value" id="totalResponses">0</div>
                                <div class="stat-label">Total Responses</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-value" id="toolsCount">0</div>
                                <div class="stat-label">Different AI Tools Used</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-value" id="avgUsage">0.00</div>
                                <div class="stat-label">Avg. Usage Frequency</div>
                            </div>
                        </div>
                        
                        <div class="text-center mt-4">
                            <button class="btn btn-primary" id="trainModelBtn">Train Prediction Model</button>
                        </div>
                    </div>
                </div>
                
                <!-- Model Training Success Message -->
                <div id="modelSuccessMessage" class="status-message success" style="display: none;">
                    <i class="fas fa-check-circle me-2"></i>
                    <span id="modelSuccessText">Model trained successfully! Accuracy: 0.00</span>
                </div>
            </div>

            <!-- Dashboard Tab -->
            <div class="tab-pane fade" id="dashboard" role="tabpanel" aria-labelledby="dashboard-tab">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Filter Data</h2>
                </div>
                
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="filter-container" id="facultyFilter">
                            <h5 class="w-100">Select Faculties</h5>
                            <div class="filter-tag">
                                Business <i class="fas fa-times"></i>
                            </div>
                            <div class="filter-tag">
                                Engineering <i class="fas fa-times"></i>
                            </div>
                            <div class="filter-tag">
                                Education <i class="fas fa-times"></i>
                            </div>
                            <div class="filter-tag">
                                Health Sciences <i class="fas fa-times"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="filter-container" id="studyLevelFilter">
                            <h5 class="w-100">Select Study Levels</h5>
                            <div class="filter-tag">
                                Undergraduate <i class="fas fa-times"></i>
                            </div>
                            <div class="filter-tag">
                                Postgraduate <i class="fas fa-times"></i>
                            </div>
                            <div class="filter-tag">
                                Other <i class="fas fa-times"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="stats-container">
                    <h4>Key Metrics</h4>
                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-value">70.0%</div>
                            <div class="stat-label">AI Familiarity</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value">70.0%</div>
                            <div class="stat-label">AI Tools Usage</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value">33.5%</div>
                            <div class="stat-label">Positive Learning Impact</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value">2.31</div>
                            <div class="stat-label">Avg Usage Frequency</div>
                        </div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <h4>Data Visualizations</h4>
                    <div class="chart-tabs">
                        <div class="chart-tab active" data-chart="familiarity">AI Familiarity</div>
                        <div class="chart-tab" data-chart="tools">Tool Usage</div>
                        <div class="chart-tab" data-chart="faculty">Faculty Adoption</div>
                        <div class="chart-tab" data-chart="challenges">Challenges</div>
                    </div>
                    <div class="chart-area">
                        <canvas id="visualizationChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Predictions Tab -->
            <div class="tab-pane fade" id="predictions" role="tabpanel" aria-labelledby="predictions-tab">
                <h2>AI Predictions</h2>
                <div class="row">
                    <div class="col-md-8">
                        <div class="card mb-4">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <div>
                                    <i class="fas fa-brain me-1"></i>
                                    Make Prediction
                                </div>
                            </div>
                            <div class="card-body">
                                <a href="{% url 'quiz:make_new_prediction' %}" class="btn btn-primary">
                                    <i class="fas fa-plus me-1"></i> Make New Prediction
                                </a>
                                <hr>
                                <h5>Recent Predictions</h5>
                                <div class="table-responsive">
                                    <table class="table table-bordered">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Model</th>
                                                <th>Result</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="recentPredictionsTable">
                                            <!-- Will be populated with data -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card mb-4">
                            <div class="card-header">
                                <i class="fas fa-info-circle me-1"></i>
                                About AI Predictions
                            </div>
                            <div class="card-body">
                                <p>Our AI prediction system analyzes student data to predict their likelihood of success in courses or exams.</p>
                                <p>The system uses machine learning algorithms trained on historical student data.</p>
                                <div class="alert alert-warning small">
                                    <i class="fas fa-exclamation-triangle me-1"></i>
                                    AI predictions are tools to assist educators, not replace their judgment.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Insights Tab -->
            <div class="tab-pane fade" id="insights" role="tabpanel" aria-labelledby="insights-tab">
                <h2>AI-Generated Insights & Recommendations</h2>
                <div id="insightsContainer">
                    <!-- Will be populated with insights -->
                    <div class="text-center py-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-3">Loading insights...</p>
                    </div>
                </div>
            </div>
            
            <!-- Admin Tab -->
            <div class="tab-pane fade" id="admin" role="tabpanel" aria-labelledby="admin-tab">
                <h2>Admin Settings</h2>
                <div class="row">
                    <div class="col-md-6">
                        <div class="card mb-4">
                            <div class="card-header">
                                <i class="fas fa-robot me-1"></i>
                                AI Model Management
                            </div>
                            <div class="card-body">
                                <div id="aiModelsContainer">
                                    <!-- Will be populated with models -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card mb-4">
                            <div class="card-header">
                                <i class="fas fa-cogs me-1"></i>
                                System Settings
                            </div>
                            <div class="card-body">
                                <!-- System settings form -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{% static 'js/ai_dashboard.js' %}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Navigation functionality
    const navLinks = document.querySelectorAll('.ai-nav-link');
    const sections = {
        'nav-data-upload': 'section-data-upload',
        'nav-dashboard': 'section-dashboard',
        'nav-predictions': 'section-predictions',
        'nav-insights': 'section-insights',
        'nav-admin': 'section-admin'
    };
    
    navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Remove active class from all links
            navLinks.forEach(l => l.classList.remove('active'));
            
            // Add active class to clicked link
            this.classList.add('active');
            
            // Hide all sections
            Object.values(sections).forEach(section => {
                document.getElementById(section).style.display = 'none';
            });
            
            // Show the corresponding section
            const sectionId = sections[this.id];
            document.getElementById(sectionId).style.display = 'block';
        });
    });
    
    // File upload functionality
    const dropArea = document.getElementById('drop-area');
    const fileInput = document.getElementById('fileInput');
    const browseButton = document.getElementById('browseButton');
    const filePreview = document.getElementById('filePreview');
    const fileName = document.getElementById('fileName');
    const fileSize = document.getElementById('fileSize');
    const removeFile = document.getElementById('removeFile');
    const uploadForm = document.getElementById('uploadForm');
    const processingIndicator = document.getElementById('processingIndicator');
    const processingText = document.getElementById('processingText');
    const stopProcessingBtn = document.getElementById('stopProcessingBtn');
    
    // Browse button click
    browseButton.addEventListener('click', function() {
        fileInput.click();
    });
    
    // File input change
    fileInput.addEventListener('change', function() {
        handleFiles(this.files);
    });
    
    // Prevent default drag behaviors
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropArea.addEventListener(eventName, preventDefaults, false);
    });
    
    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }
    
    // Highlight drop area when dragging over it
    ['dragenter', 'dragover'].forEach(eventName => {
        dropArea.addEventListener(eventName, highlight, false);
    });
    
    ['dragleave', 'drop'].forEach(eventName => {
        dropArea.addEventListener(eventName, unhighlight, false);
    });
    
    function highlight() {
        dropArea.classList.add('highlight');
    }
    
    function unhighlight() {
        dropArea.classList.remove('highlight');
    }
    
    // Handle dropped files
    dropArea.addEventListener('drop', function(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        handleFiles(files);
    });
    
    function handleFiles(files) {
        if (files.length > 0) {
            const file = files[0];
            
            // Check if file is CSV
            if (file.type !== 'text/csv' && !file.name.endsWith('.csv')) {
                alert('Please upload a CSV file');
                return;
            }
            
            // Display file info
            fileName.textContent = file.name;
            fileSize.textContent = formatFileSize(file.size);
            filePreview.style.display = 'block';
            
            // Simulate processing
            simulateProcessing(file);
        }
    }
    
    // Remove file button
    removeFile.addEventListener('click', function() {
        fileInput.value = '';
        filePreview.style.display = 'none';
        
        // Hide other sections that depend on file upload
        document.getElementById('dataPreviewSection').style.display = 'none';
        document.getElementById('successMessage').style.display = 'none';
        document.getElementById('skippedMessage').style.display = 'none';
        document.getElementById('statsSection').style.display = 'none';
        document.getElementById('modelSuccessMessage').style.display = 'none';
    });
    
    // Format file size
    function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        
        return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
    }
    
    // Simulate file processing
    function simulateProcessing(file) {
        // Show processing indicator
        processingIndicator.style.display = 'flex';
        
        // Read CSV file to get preview data
        const reader = new FileReader();
        
        reader.onload = function(e) {
            const csv = e.target.result;
            const lines = csv.split('\n');
            const headers = lines[0].split(',');
            
            // Create table headers
            const headerRow = document.getElementById('previewTableHeader');
            headerRow.innerHTML = '';
            
            headers.forEach((header, index) => {
                const th = document.createElement('th');
                th.textContent = `${index + 1}. ${header.trim()}`;
                headerRow.appendChild(th);
            });
            
            // Create table rows
            const tableBody = document.getElementById('previewTableBody');
            tableBody.innerHTML = '';
            
            // Display up to 5 data rows
            const maxRows = Math.min(lines.length - 1, 5);
            
            for (let i = 1; i <= maxRows; i++) {
                if (lines[i].trim() === '') continue;
                
                const rowData = lines[i].split(',');
                const row = document.createElement('tr');
                
                // Add row index cell
                const indexCell = document.createElement('td');
                indexCell.textContent = i - 1;
                row.appendChild(indexCell);
                
                rowData.forEach((cell, j) => {
                    if (j > 0) {
                        const td = document.createElement('td');
                        td.textContent = cell.trim();
                        row.appendChild(td);
                    }
                });
                
                tableBody.appendChild(row);
            }
            
            // After a delay to simulate processing
            setTimeout(() => {
                // Hide processing indicator
                processingIndicator.style.display = 'none';
                
                // Show data preview section
                document.getElementById('dataPreviewSection').style.display = 'block';
                
                // Show success message
                document.getElementById('successMessage').style.display = 'block';
                document.getElementById('successText').textContent = `Data successfully uploaded! Added 1224 new records.`;
                
                // Show skipped message
                document.getElementById('skippedMessage').style.display = 'block';
                document.getElementById('skippedText').textContent = `Skipped 1 existing record to avoid duplicates.`;
                
                // Show stats section
                document.getElementById('statsSection').style.display = 'block';
                document.getElementById('totalResponses').textContent = '1224';
                document.getElementById('toolsCount').textContent = '7';
                document.getElementById('avgUsage').textContent = '2.31';
            }, 2000);
        };
        
        reader.readAsText(file);
    }
    
    // Train model button click
    document.getElementById('trainModelBtn').addEventListener('click', function() {
        // Show processing indicator
        processingIndicator.style.display = 'flex';
        processingText.textContent = 'Training model...';
        
        // After a delay to simulate processing
        setTimeout(() => {
            // Hide processing indicator
            processingIndicator.style.display = 'none';
            
            // Show model success message
            document.getElementById('modelSuccessMessage').style.display = 'block';
            document.getElementById('modelSuccessText').textContent = `Model trained successfully! Accuracy: 0.61`;
        }, 3000);
    });
    
    // Initialize charts for dashboard
    function initializeCharts() {
        // AI Familiarity Distribution Chart
        const familiarityCtx = document.getElementById('visualizationChart').getContext('2d');
        const familiarityChart = new Chart(familiarityCtx, {
            type: 'bar',
            data: {
                labels: ['Not familiar at all', 'Somewhat familiar', 'Very familiar'],
                datasets: [{
                    label: 'Number of Respondents',
                    data: [370, 650, 210],
                    backgroundColor: ['#ffc107', '#17a2b8', '#007bff'],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Number of Respondents'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Familiarity Level'
                        }
                    }
                }
            }
        });
        
        // Faculty Prediction Chart
        const predictionCtx = document.getElementById('facultyPredictionChart').getContext('2d');
        const predictionChart = new Chart(predictionCtx, {
            type: 'bar',
            data: {
                labels: ['Business', 'Education', 'Engineering', 'Health Sciences'],
                datasets: [
                    {
                        label: 'Undergraduate',
                        data: [32, 28, 31, 33],
                        backgroundColor: '#007bff'
                    },
                    {
                        label: 'Postgraduate',
                        data: [29, 37, 35, 28],
                        backgroundColor: '#28a745'
                    },
                    {
                        label: 'Other',
                        data: [30, 29, 32, 36],
                        backgroundColor: '#6f42c1'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        stacked: true
                    },
                    y: {
                        stacked: false,
                        title: {
                            display: true,
                            text: 'Predicted Adoption Probability'
                        },
                        ticks: {
                            callback: function(value) {
                                return value + '%';
                            }
                        }
                    }
                }
            }
        });
        
        // Factors Chart
        const factorsCtx = document.getElementById('factorsChart').getContext('2d');
        const factorsChart = new Chart(factorsCtx, {
            type: 'bar',
            data: {
                labels: ['AI Familiarity', 'Current Tool Usage', 'Encountered Challenges', 'Faculty Affiliation', 'Level of Study'],
                datasets: [{
                    data: [0.26, 0.15, 0.26, 0.11, 0.22],
                    backgroundColor: '#007bff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Feature Importance'
                        }
                    }
                }
            }
        });
        
        // Tab switching for visualization charts
        const chartTabs = document.querySelectorAll('.chart-tab');
        
        chartTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                // Remove active class from all tabs
                chartTabs.forEach(t => t.classList.remove('active'));
                
                // Add active class to clicked tab
                this.classList.add('active');
                
                // Update chart based on selected tab
                const chartType = this.getAttribute('data-chart');
                
                switch(chartType) {
                    case 'familiarity':
                        familiarityChart.data.labels = ['Not familiar at all', 'Somewhat familiar', 'Very familiar'];
                        familiarityChart.data.datasets[0].data = [370, 650, 210];
                        familiarityChart.update();
                        break;
                    case 'tools':
                        familiarityChart.data.labels = ['ChatGPT', 'GitHub Copilot', 'Grammarly', 'Midjourney', 'DALL-E'];
                        familiarityChart.data.datasets[0].data = [720, 350, 280, 150, 100];
                        familiarityChart.update();
                        break;
                    case 'faculty':
                        familiarityChart.data.labels = ['Business', 'Engineering', 'Education', 'Health Sciences', 'Arts'];
                        familiarityChart.data.datasets[0].data = [350, 420, 280, 150, 70];
                        familiarityChart.update();
                        break;
                    case 'challenges':
                        familiarityChart.data.labels = ['Understanding outputs', 'Access', 'Cost', 'Technical skills', 'Integration'];
                        familiarityChart.data.datasets[0].data = [450, 380, 320, 250, 180];
                        familiarityChart.update();
                        break;
                }
            });
        });
    }
    
    // Initialize charts when dashboard tab is clicked
    document.getElementById('nav-dashboard').addEventListener('click', function() {
        setTimeout(initializeCharts, 100);
    });
    
    // Also initialize charts when predictions tab is clicked
    document.getElementById('nav-predictions').addEventListener('click', function() {
        setTimeout(initializeCharts, 100);
    });
    
    // Show checkbox functionality
    const showSkippedCheckbox = document.getElementById('showSkipped');
    if (showSkippedCheckbox) {
        showSkippedCheckbox.addEventListener('change', function() {
            console.log('Show skipped emails:', this.checked);
        });
    }
    
    // Stop processing button
    stopProcessingBtn.addEventListener('click', function() {
        processingIndicator.style.display = 'none';
    });
});
</script>
{% endblock %} 