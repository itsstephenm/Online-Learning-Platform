{% extends 'student/studentbase.html' %}
{% block content %}
<div class="app-container">
  <div class="main-card">
    <div class="card-header">
      <h5><i class="fas fa-robot mr-2"></i> AI Quiz Assistant</h5>
      <div class="connection-status">
        <span id="connection-indicator" class="status-indicator offline"></span>
        <span id="connection-text">Checking connection...</span>
      </div>
    </div>
    <div class="card-body two-column-layout">
      <!-- Left Column - Chat Section -->
      <section class="chat-section">
        <div class="chat-window">
          <div id="chat-messages" class="chat-messages" aria-live="polite">
            {% for chat in chat_history %}
            <!-- User Message -->
            <div class="chat-message user-message">
              <div class="message-bubble">
                <div class="message-meta">
                  <i class="fas fa-user-circle"></i>
                  <small class="message-time">{{ chat.timestamp|date:"h:i A" }}</small>
                </div>
                <div class="message-text">
                  {{ chat.question }}
                </div>
              </div>
            </div>
            <!-- AI Response -->
            <div class="chat-message ai-message">
              <div class="message-bubble">
                <div class="message-meta">
                  <i class="fas fa-robot"></i>
                  <small class="message-time">{{ chat.timestamp|date:"h:i A" }}</small>
                </div>
                <div class="message-text markdown-content" data-markdown="{{ chat.answer|escapejs }}">
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
          <form id="chat-form" class="chat-form" method="post">
            {% csrf_token %}
            <div class="form-controls">
              <select id="course-select" class="course-select">
                <option value="">Select a course (optional)</option>
                {% for course in courses %}
                <option value="{{ course.id }}" {% if selected_course == course.id %}selected{% endif %}>
                  {{ course.course_name }}
                </option>
                {% endfor %}
              </select>
              <div class="input-area">
                <input type="text" id="question-input" placeholder="Ask a question about your studies..." autocomplete="off">
                <button type="submit" class="send-btn" aria-label="Send">
                  <i class="fas fa-paper-plane"></i>
                </button>
              </div>
            </div>
          </form>
        </div>
      </section>
      
      <!-- Right Column - Stats & Tips -->
      <section class="info-section">
        <!-- Usage Statistics -->
        <div class="stats-card">
          <h6><i class="fas fa-chart-bar mr-2"></i> AI Usage Statistics</h6>
          <ul class="stats-list">
            <li>
              <span>Total Queries</span>
              <span class="badge">{{ insights.total_queries }}</span>
            </li>
            <li>
              <span>Average Response Time</span>
              <span class="badge">{{ insights.average_response_time|floatformat:1 }}s</span>
            </li>
            <li>
              <span>Last Used</span>
              <span>{{ student.last_ai_interaction|default:"Never" }}</span>
            </li>
          </ul>
        </div>
        
        <!-- Tips -->
        <div class="tips-card">
          <h6><i class="fas fa-lightbulb mr-2"></i> Tips for Better Results</h6>
          <ul class="tips-list">
            <li><i class="fas fa-check-circle"></i> Be specific in your questions</li>
            <li><i class="fas fa-check-circle"></i> Select a course for context-specific answers</li>
            <li><i class="fas fa-check-circle"></i> Ask for explanations of concepts</li>
            <li><i class="fas fa-check-circle"></i> Request practice problems</li>
            <li><i class="fas fa-check-circle"></i> Ask for study strategies</li>
          </ul>
        </div>
      </section>
    </div>
  </div>
</div>
<!-- External Resources -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.6/marked.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>

<script>
// Configure marked.js with options
marked.setOptions({
    highlight: function(code, lang) {
        const language = hljs.getLanguage(lang) ? lang : 'plaintext';
        return hljs.highlight(code, { language }).value;
    },
    langPrefix: 'hljs language-',
    gfm: true,
    breaks: true
});

// Override code block rendering
const renderer = {
    code(code, language) {
        const validLanguage = hljs.getLanguage(language) ? language : 'plaintext';
        const highlightedCode = hljs.highlight(code, { language: validLanguage }).value;
        
        return `<div class="code-block">
            <div class="code-header">
                <span class="code-language">${validLanguage}</span>
                <div class="code-actions">
                    <button class="copy-button" onclick="copyCode(this)" aria-label="Copy code">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                        Copy
                    </button>
                    <button class="edit-button" onclick="editCode(this)" aria-label="Edit code">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
                        </svg>
                        Edit
                    </button>
                </div>
            </div>
            <div class="code-content">
                <pre><code class="language-${validLanguage}">${highlightedCode}</code></pre>
            </div>
            <div class="copy-tooltip">Copied!</div>
        </div>`;
    }
};

marked.use({ renderer });

// Function to check AI service connection
function checkAIConnection() {
    const connectionIndicator = document.getElementById('connection-indicator');
    const connectionText = document.getElementById('connection-text');
    
    fetch('{% url "check_ai_connection" %}', {
        method: 'GET',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.connected) {
            connectionIndicator.className = 'status-indicator online';
            connectionText.textContent = 'AI Service Connected';
            connectionText.className = 'connection-text online';
            document.getElementById('question-input').disabled = false;
            document.querySelector('.send-btn').disabled = false;
        } else {
            connectionIndicator.className = 'status-indicator offline';
            connectionText.textContent = 'AI Service Disconnected';
            connectionText.className = 'connection-text offline';
            document.getElementById('question-input').disabled = true;
            document.querySelector('.send-btn').disabled = true;
        }
    })
    .catch(error => {
        console.error('Connection check failed:', error);
        connectionIndicator.className = 'status-indicator offline';
        connectionText.textContent = 'Connection Error';
        connectionText.className = 'connection-text offline';
        document.getElementById('question-input').disabled = true;
        document.querySelector('.send-btn').disabled = true;
    });
}

// Function to process markdown content
function processMarkdown(content) {
    try {
        // First unescape any Unicode escape sequences
        const unescapedContent = content.replace(/\\u([a-fA-F0-9]{4})/g, (match, p1) => {
            return String.fromCharCode(parseInt(p1, 16));
        });
        
        // Remove any remaining escape sequences that might interfere with markdown
        const cleanContent = unescapedContent.replace(/\\([^u])/g, '$1');
        
        // Parse the cleaned content as markdown
        return marked.parse(cleanContent);
    } catch (error) {
        console.error('Error parsing markdown:', error);
        console.error('Content that failed:', content);
        return content;
    }
}

// Process existing markdown content when page loads
document.addEventListener('DOMContentLoaded', function() {
    // Process existing markdown content
    document.querySelectorAll('.markdown-content[data-markdown]').forEach(element => {
        const markdownContent = element.getAttribute('data-markdown');
        console.log('Processing markdown content:', markdownContent);
        element.innerHTML = processMarkdown(markdownContent);
    });

    const chatForm = document.getElementById('chat-form');
    const questionInput = document.getElementById('question-input');
    const courseSelect = document.getElementById('course-select');
    const chatMessages = document.getElementById('chat-messages');
    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

    chatMessages.scrollTop = chatMessages.scrollHeight;
    
    // Check connection initially
    checkAIConnection();
    
    // Set up periodic connection checks
    setInterval(checkAIConnection, 30000); // Check every 30 seconds

    chatForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        const question = questionInput.value.trim();
        if (!question) return;

        const submitButton = this.querySelector('.send-btn');
        submitButton.disabled = true;
        submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        appendMessage('user', question);
        questionInput.value = '';
        const typingIndicator = createTypingIndicator();
        chatMessages.appendChild(typingIndicator);
        chatMessages.scrollTop = chatMessages.scrollHeight;

        try {
            const response = await fetch('{% url "get_ai_response" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken
                },
                body: JSON.stringify({
                    question: question,
                    course_id: courseSelect.value
                })
            });
            if (!response.ok) {
                let errorMsg = `Server error: ${response.status}`;
                try {
                    const errorData = await response.json();
                    if (errorData.error) errorMsg = errorData.error;
                } catch (e) {}
                throw new Error(errorMsg);
            }
            
            const data = await response.json();
            chatMessages.removeChild(typingIndicator);
            
            if (data.error) {
                appendMessage('ai', `Sorry, I encountered an error: ${data.error}`);
                // Update connection status if there's a connection issue
                checkAIConnection();
            } else if (!data.response || data.response.trim() === '') {
                appendMessage('ai', 'Sorry, I couldn\'t generate a response. Please try again.');
                checkAIConnection();
            } else {
                appendMessage('ai', data.response);
            }
        } catch (error) {
            console.error('Error:', error);
            chatMessages.removeChild(typingIndicator);
            appendMessage('ai', `Sorry, I encountered an error: ${error.message || 'Unknown error'}`);
            checkAIConnection();
        } finally {
            submitButton.disabled = false;
            submitButton.innerHTML = '<i class="fas fa-paper-plane"></i>';
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
    });

    function appendMessage(sender, message) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `chat-message ${sender === 'user' ? 'user-message' : 'ai-message'}`;
        const bubble = document.createElement('div');
        bubble.className = 'message-bubble';
        const meta = document.createElement('div');
        meta.className = 'message-meta';
        meta.innerHTML = sender === 'ai'
            ? `<i class="fas fa-robot"></i><small class="message-time">${moment().format('h:mm A')}</small>`
            : `<i class="fas fa-user-circle"></i><small class="message-time">${moment().format('h:mm A')}</small>`;
        const text = document.createElement('div');
        text.className = 'message-text' + (sender === 'ai' ? ' markdown-content' : '');
        
        // Only parse markdown for AI messages
        text.innerHTML = sender === 'ai' ? processMarkdown(message) : message;
        
        bubble.appendChild(meta);
        bubble.appendChild(text);
        messageDiv.appendChild(bubble);
        chatMessages.appendChild(messageDiv);
        
        // Scroll to bottom
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function createTypingIndicator() {
        const container = document.createElement('div');
        container.className = 'chat-message ai-message typing-indicator';
        container.innerHTML = `
            <div class="message-bubble">
              <div class="message-meta">
                <i class="fas fa-robot"></i>
              </div>
              <div class="message-text">
                <div class="typing-dots">
                  <span></span><span></span><span></span>
                </div>
              </div>
            </div>
        `;
        return container;
    }

    // Initialize copy buttons for code blocks
    function initializeCodeActions() {
        document.querySelectorAll('.copy-button').forEach(button => {
            button.addEventListener('click', function() {
                const codeBlock = this.closest('.code-block');
                const code = codeBlock.querySelector('code');
                const tooltip = codeBlock.querySelector('.copy-tooltip');
                
                navigator.clipboard.writeText(code.innerText).then(() => {
                    tooltip.classList.add('show');
                    
                    const originalContent = this.innerHTML;
                    this.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                        Copied!
                    `;
                    this.style.color = '#50fa7b';
                    
                    setTimeout(() => {
                        tooltip.classList.remove('show');
                        this.innerHTML = originalContent;
                        this.style.color = '';
                    }, 2000);
                });
            });
        });

        document.querySelectorAll('.edit-button').forEach(button => {
            button.addEventListener('click', function() {
                const codeBlock = this.closest('.code-block');
                const codeContent = codeBlock.querySelector('.code-content');
                const code = codeBlock.querySelector('code');
                const originalCode = code.innerText;
                
                const textarea = document.createElement('textarea');
                textarea.className = 'code-edit-textarea';
                textarea.value = originalCode;
                
                const actions = document.createElement('div');
                actions.className = 'code-edit-actions';
                
                const saveButton = document.createElement('button');
                saveButton.textContent = 'Save';
                saveButton.className = 'copy-button';
                
                const cancelButton = document.createElement('button');
                cancelButton.textContent = 'Cancel';
                cancelButton.className = 'edit-button';
                
                actions.appendChild(saveButton);
                actions.appendChild(cancelButton);
                
                const originalContent = codeContent.innerHTML;
                codeContent.innerHTML = '';
                codeContent.appendChild(textarea);
                codeContent.appendChild(actions);
                
                saveButton.onclick = () => {
                    const newCode = textarea.value;
                    const language = code.className.replace('language-', '');
                    const highlightedCode = hljs.highlight(newCode, { language }).value;
                    code.innerHTML = highlightedCode;
                    codeContent.innerHTML = originalContent;
                };
                
                cancelButton.onclick = () => {
                    codeContent.innerHTML = originalContent;
                };
                
                textarea.focus();
            });
        });
    }

    // Initialize code action buttons
    initializeCodeActions();

    // Function to copy code
    window.copyCode = function(button) {
        const codeBlock = button.closest('.code-block');
        const code = codeBlock.querySelector('code');
        const tooltip = codeBlock.querySelector('.copy-tooltip');
        
        navigator.clipboard.writeText(code.innerText).then(() => {
            tooltip.classList.add('show');
            
            const originalContent = button.innerHTML;
            button.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
                Copied!
            `;
            button.style.color = '#50fa7b';
            
            setTimeout(() => {
                tooltip.classList.remove('show');
                button.innerHTML = originalContent;
                button.style.color = '';
            }, 2000);
        });
    };

    // Function to edit code
    window.editCode = function(button) {
        const codeBlock = button.closest('.code-block');
        const codeContent = codeBlock.querySelector('.code-content');
        const code = codeBlock.querySelector('code');
        const originalCode = code.innerText;
        
        const textarea = document.createElement('textarea');
        textarea.className = 'code-edit-textarea';
        textarea.value = originalCode;
        
        const actions = document.createElement('div');
        actions.className = 'code-edit-actions';
        
        const saveButton = document.createElement('button');
        saveButton.textContent = 'Save';
        saveButton.className = 'copy-button';
        
        const cancelButton = document.createElement('button');
        cancelButton.textContent = 'Cancel';
        cancelButton.className = 'edit-button';
        
        actions.appendChild(saveButton);
        actions.appendChild(cancelButton);
        
        const originalContent = codeContent.innerHTML;
        codeContent.innerHTML = '';
        codeContent.appendChild(textarea);
        codeContent.appendChild(actions);
        
        saveButton.onclick = () => {
            const newCode = textarea.value;
            const language = code.className.replace('language-', '');
            const highlightedCode = hljs.highlight(newCode, { language }).value;
            code.innerHTML = highlightedCode;
            codeContent.innerHTML = originalContent;
        };
        
        cancelButton.onclick = () => {
            codeContent.innerHTML = originalContent;
        };
        
        textarea.focus();
    };

    questionInput.focus();
});
</script>

<style>
.app-container {
    max-width: 100%;
    height: calc(100vh - 200px);
    display: flex;
    flex-direction: column;
    margin: 0;
}

.main-card {
    flex: 1;
    display: flex;
    flex-direction: column;
    background: #1a1a27;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}

.card-header {
    background: #1e1e2d;
    padding: 1rem 1.25rem;
    color: white;
    flex-shrink: 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.card-header h5 {
    margin: 0;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
}

.card-header h5 i {
    margin-right: 8px;
    color: #24b0ed;
}

/* Connection Status Styles */
.connection-status {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.85rem;
}

.status-indicator {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    display: inline-block;
}

.status-indicator.online {
    background-color: #28a745;
    box-shadow: 0 0 8px rgba(40, 167, 69, 0.6);
}

.status-indicator.offline {
    background-color: #dc3545;
    box-shadow: 0 0 8px rgba(220, 53, 69, 0.6);
}

.connection-text {
    font-weight: 500;
}

.connection-text.online {
    color: #28a745;
}

.connection-text.offline {
    color: #dc3545;
}

.card-body {
    flex: 1;
    overflow: hidden;
    display: flex;
}

/* Two Column Layout */
.two-column-layout {
    display: flex;
    height: 100%;
    width: 100%;
}

.chat-section {
    flex: 1;
    display: flex;
    flex-direction: column;
    min-width: 0;
    padding: 0;
    height: 100%;
    background-color: #151521;
}

.info-section {
    width: 280px;
    border-left: 1px solid rgba(255, 255, 255, 0.1);
    background: #1a1a27;
    padding: 1.5rem;
    overflow-y: auto;
    height: 100%;
}

/* Stats Card */
.stats-card, .tips-card {
    background-color: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
    border-left: 4px solid #24b0ed;
}

.stats-card h6, .tips-card h6 {
    color: #fff;
    font-size: 1rem;
    margin-bottom: 1rem;
    font-weight: 600;
    display: flex;
    align-items: center;
}

.stats-card h6 i, .tips-card h6 i {
    color: #24b0ed;
    margin-right: 8px;
}

.stats-list, .tips-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.stats-list li {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.75rem;
    font-size: 0.9rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.stats-list li:last-child {
    border-bottom: none;
}

.badge {
    background: #24b0ed;
    color: white;
    padding: 0.25rem 0.5rem;
    border-radius: 0.5rem;
    font-size: 0.8rem;
    font-weight: 500;
}

/* Tips List */
.tips-list li {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.85);
}

.tips-list i {
    color: #24b0ed;
    font-size: 0.8rem;
}

/* Chat Window */
.chat-window {
    display: flex;
    flex-direction: column;
    height: 100%;
    position: relative;
}

.chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

/* Message Bubbles */
.chat-message {
    display: flex;
    margin-bottom: 1rem;
}

.message-bubble {
    max-width: 80%;
    padding: 0.75rem 1rem;
    border-radius: 1rem;
    position: relative;
}

.user-message {
    justify-content: flex-end;
}

.user-message .message-bubble {
    background-color: #24b0ed;
    color: white;
    border-bottom-right-radius: 0.25rem;
}

.ai-message .message-bubble {
    background-color: #2a2a38;
    color: #fff;
    border-bottom-left-radius: 0.25rem;
}

.message-meta {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.25rem;
    font-size: 0.85rem;
}

.user-message .message-meta i {
    color: rgba(255, 255, 255, 0.9);
}

.ai-message .message-meta i {
    color: #24b0ed;
}

.message-time {
    opacity: 0.8;
}

/* Form Controls */
.chat-form {
    padding: 1rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    background: #1a1a27;
    position: sticky;
    bottom: 0;
    z-index: 10;
}

.form-controls {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.course-select {
    padding: 0.75rem 1rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 0.5rem;
    font-size: 0.9rem;
    background-color: #2a2a38;
    color: #fff;
}

.input-area {
    display: flex;
    gap: 0.5rem;
}

#question-input {
    flex: 1;
    padding: 0.75rem 1rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 0.5rem;
    font-size: 0.9rem;
    background-color: #2a2a38;
    color: #fff;
}

#question-input:focus {
    outline: none;
    border-color: #24b0ed;
    box-shadow: 0 0 0 1px #24b0ed;
}

#question-input:disabled {
    background-color: #1e1e2d;
    cursor: not-allowed;
}

.send-btn {
    background: #24b0ed;
    color: white;
    border: none;
    border-radius: 0.5rem;
    padding: 0.75rem 1.25rem;
    cursor: pointer;
    transition: all 0.3s ease;
}

.send-btn:hover {
    background-color: #1a8cbb;
    transform: translateY(-2px);
}

.send-btn:disabled {
    background: #343444;
    cursor: not-allowed;
}

/* Code Block Layout */
.code-block {
    background: #1e1e2d;
    border-radius: 8px;
    margin: 16px 0;
    overflow: hidden;
    position: relative;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    max-width: 100%;
    width: 100%;
}

.code-content {
    margin: 0;
    padding: 16px;
    background: #1e1e2d;
    max-height: 300px;
    overflow-y: auto;
}

.code-content pre {
    margin: 0;
    padding: 0;
    background: transparent;
    overflow-x: auto;
    max-width: 100%;
    white-space: pre-wrap;
    word-break: break-word;
}

.code-content code {
    font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
    font-size: 0.9em;
    line-height: 1.5;
    color: #e6e6e6;
    width: 100%;
    display: inline-block;
}

/* Code Header */
.code-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 16px;
    background: #2d2d2d;
    border-bottom: 1px solid #404040;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
}

.code-language {
    font-size: 0.85rem;
    font-weight: 500;
    color: #808080;
    text-transform: lowercase;
}

.code-actions {
    display: flex;
    gap: 8px;
    align-items: center;
}

.copy-button, .edit-button {
    display: flex;
    align-items: center;
    gap: 6px;
    background: transparent;
    border: 1px solid #404040;
    border-radius: 4px;
    padding: 4px 8px;
    font-size: 0.75rem;
    color: #808080;
    cursor: pointer;
    transition: all 0.2s ease;
}

.copy-button:hover, .edit-button:hover {
    background: rgba(255,255,255,0.1);
    border-color: #606060;
    color: #fff;
}

.copy-button svg, .edit-button svg {
    width: 14px;
    height: 14px;
    stroke: currentColor;
}

/* Typing Indicator */
.typing-indicator .typing-dots {
    display: inline-flex;
    align-items: center;
}

.typing-dots span {
    width: 8px;
    height: 8px;
    margin: 0 2px;
    background-color: #24b0ed;
    border-radius: 50%;
    animation: typingAnimation 1.4s infinite ease-in-out;
}

.typing-dots span:nth-child(1) { animation-delay: 0s; }
.typing-dots span:nth-child(2) { animation-delay: 0.2s; }
.typing-dots span:nth-child(3) { animation-delay: 0.4s; }

@keyframes typingAnimation {
    0%, 60%, 100% { transform: translateY(0); }
    30% { transform: translateY(-5px); }
}

/* Pulse animation for connection indicator */
@keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7); }
    70% { box-shadow: 0 0 0 10px rgba(40, 167, 69, 0); }
    100% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0); }
}

.status-indicator.online {
    animation: pulse 2s infinite;
}

/* Make the chat area more readable */
.message-text {
    font-size: 0.95rem;
    line-height: 1.5;
}

.message-text p {
    margin-top: 0;
    margin-bottom: 0.75rem;
}

.message-text p:last-child {
    margin-bottom: 0;
}

.message-text ul, .message-text ol {
    margin-top: 0;
    margin-bottom: 1rem;
    padding-left: 1.5rem;
}

.message-text a {
    color: #24b0ed;
    text-decoration: none;
}

.message-text a:hover {
    text-decoration: underline;
}

.message-text code:not(.hljs) {
    font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
    background-color: rgba(0, 0, 0, 0.2);
    padding: 0.2em 0.4em;
    border-radius: 3px;
    font-size: 0.9em;
}

/* Responsive Design */
@media (max-width: 768px) {
    .two-column-layout {
        flex-direction: column;
    }
    
    .chat-section {
        flex: 1;
        min-height: 60vh;
    }
    
    .info-section {
        width: 100%;
        border-left: none;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .app-container {
        height: auto;
        min-height: calc(100vh - 200px);
    }
    
    .card-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
    }
    
    .connection-status {
        width: 100%;
        justify-content: flex-start;
    }
}
</style>
{% endblock content %}